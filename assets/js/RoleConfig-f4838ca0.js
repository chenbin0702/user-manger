import{_ as F,r,l as z,a as p,o as P,g as L,w as n,e as b,b as t,f as _,c as D,v as W,x as X,y as Y,p as C,u as Z,s as ee,t as te,z as ne,q as ie}from"./index-58786321.js";const se={class:"dialog-footer"},ae={__name:"RoleForm",props:{visible:Boolean,isEdit:Boolean,roleData:{type:Object,default:()=>({})}},emits:["update:visible","submit"],setup(f,{emit:d}){const y=f,m=d,g=r(!1),u=r(null),o=r({name:"",description:""}),k={name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"},{max:200,message:"最多 200 个字符",trigger:"blur"}]};z(()=>y.visible,l=>{g.value=l,l&&y.isEdit&&(o.value={...y.roleData})}),z(g,l=>{var s;m("update:visible",l),l||(s=u.value)==null||s.resetFields()});const h=()=>{g.value=!1},w=async()=>{u.value&&await u.value.validate(l=>{l&&(m("submit",o.value),h())})};return(l,s)=>{const V=p("el-input"),x=p("el-form-item"),T=p("el-form"),S=p("el-button"),K=p("el-dialog");return P(),L(K,{modelValue:g.value,"onUpdate:modelValue":s[2]||(s[2]=c=>g.value=c),title:f.isEdit?"编辑角色":"新建角色",width:"500px",onClose:h},{footer:n(()=>[b("span",se,[t(S,{onClick:h},{default:n(()=>s[3]||(s[3]=[_("取消")])),_:1}),t(S,{type:"primary",onClick:w},{default:n(()=>s[4]||(s[4]=[_("确定")])),_:1})])]),default:n(()=>[t(T,{ref_key:"formRef",ref:u,model:o.value,rules:k,"label-width":"100px"},{default:n(()=>[t(x,{label:"角色名称",prop:"name"},{default:n(()=>[t(V,{modelValue:o.value.name,"onUpdate:modelValue":s[0]||(s[0]=c=>o.value.name=c)},null,8,["modelValue"])]),_:1}),t(x,{label:"角色描述",prop:"description"},{default:n(()=>[t(V,{modelValue:o.value.description,"onUpdate:modelValue":s[1]||(s[1]=c=>o.value.description=c),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}},oe=F(ae,[["__scopeId","data-v-49aea221"]]),re={class:"permission-tree"},le={__name:"PermissionTree",props:{permissions:{type:Array,required:!0},checkedKeys:{type:Array,default:()=>[]}},emits:["update:checkedKeys"],setup(f,{emit:d}){const y=d,m=r(null),g=()=>{if(!m.value)return;const u=m.value.getCheckedKeys(),o=m.value.getHalfCheckedKeys();y("update:checkedKeys",[...u,...o])};return(u,o)=>{const k=p("el-tree");return P(),D("div",re,[t(k,{ref_key:"treeRef",ref:m,data:f.permissions,"show-checkbox":"","node-key":"id","default-checked-keys":f.checkedKeys,props:{children:"children",label:"name"},onCheck:g},null,8,["data","default-checked-keys"])])}}},$=[{id:1,name:"超级管理员",description:"系统最高权限角色",createTime:"2023-07-20 10:00:00",permissions:[11,12,13,14,21,22,23,24,31,32,33]},{id:2,name:"运营管理员",description:"负责日常运营管理",createTime:"2023-07-21 11:00:00",permissions:[11,12,21,31]},{id:3,name:"飞手",description:"执飞任务人员",createTime:"2023-07-22 14:00:00",permissions:[11,31]}],me=[{id:1,name:"用户管理",children:[{id:11,name:"查看用户列表"},{id:12,name:"新增用户"},{id:13,name:"编辑用户"},{id:14,name:"删除用户"}]},{id:2,name:"角色管理",children:[{id:21,name:"查看角色"},{id:22,name:"新增角色"},{id:23,name:"编辑角色"},{id:24,name:"删除角色"}]},{id:3,name:"认证管理",children:[{id:31,name:"查看认证信息"},{id:32,name:"审核认证"},{id:33,name:"管理证书"}]}],E={getRoles(){return Promise.resolve($)},getPermissions(){return Promise.resolve(me)},getRolePermissions(f){const d=$.find(y=>y.id===f);return Promise.resolve(d?d.permissions:[])},saveRolePermissions(f,d){return console.log("Saving permissions:",{roleId:f,permissions:d}),Promise.resolve(!0)}};const pe={class:"role-config"},de={class:"header"},ue={class:"actions"},ce={class:"search-bar"},ye={class:"pagination"},he={key:0},ve={class:"permission-title"},fe={class:"dialog-footer"},_e={__name:"RoleConfig",setup(f){const d=r([{id:1,name:"超级管理员",description:"系统最高权限角色",createTime:"2023-07-20 10:00:00"},{id:2,name:"运营管理员",description:"负责日常运营管理",createTime:"2023-07-21 11:00:00"},{id:3,name:"飞手",description:"执飞任务人员",createTime:"2023-07-22 14:00:00"}]),y=r(!1),m=r({keyword:""}),g=r([{id:1,name:"仪表盘",icon:"Odometer",path:"/dashboard",type:"menu",permission:"dashboard"},{id:2,name:"用户管理",icon:"User",path:"/user",type:"menu",permission:"user",children:[{id:21,name:"账户管理",path:"/user/account",type:"menu",permission:"user:account",children:[{id:211,name:"用户列表",path:"/user/account/list",type:"menu",permission:"user:account:list"},{id:212,name:"角色配置",path:"/user/account/roles",type:"menu",permission:"user:account:roles"}]},{id:22,name:"认证管理",path:"/user/auth",type:"menu",permission:"user:auth",children:[{id:221,name:"实名认证审核",path:"/user/auth/identity",type:"menu",permission:"user:auth:identity"},{id:222,name:"飞手资质审核",path:"/user/auth/pilot",type:"menu",permission:"user:auth:pilot"},{id:223,name:"证书管理",path:"/user/auth/certificate",type:"menu",permission:"user:auth:certificate"}]}]},{id:3,name:"设备管理",icon:"Box",path:"/equipment",type:"menu",permission:"equipment",children:[{id:31,name:"设备分类",path:"/equipment/categories",type:"menu",permission:"equipment:categories"},{id:32,name:"设备列表",path:"/equipment/list",type:"menu",permission:"equipment:list"},{id:33,name:"库存管理",path:"/equipment/inventory",type:"menu",permission:"equipment:inventory"}]},{id:4,name:"租赁管理",icon:"Tickets",path:"/rental",type:"menu",permission:"rental",children:[{id:41,name:"租赁订单",path:"/rental/orders",type:"menu",permission:"rental:orders"},{id:42,name:"租赁规则",path:"/rental/rules",type:"menu",permission:"rental:rules"},{id:43,name:"押金管理",path:"/rental/deposits",type:"menu",permission:"rental:deposits"}]},{id:5,name:"订单管理",icon:"Document",path:"/order",type:"menu",permission:"order",children:[{id:51,name:"订单列表",path:"/order/list",type:"menu",permission:"order:list"},{id:52,name:"订单统计",path:"/order/statistics",type:"menu",permission:"order:statistics"},{id:53,name:"订单分类",path:"/order/categories",type:"menu",permission:"order:categories"},{id:54,name:"培训订单",path:"/order/training",type:"menu",permission:"order:training",children:[{id:541,name:"课程订单",path:"/order/training/course",type:"menu",permission:"order:training:course"},{id:542,name:"考证订单",path:"/order/training/certificate",type:"menu",permission:"order:training:certificate"}]},{id:55,name:"保险订单",path:"/order/insurance",type:"menu",permission:"order:insurance",children:[{id:551,name:"保单管理",path:"/order/insurance/policy",type:"menu",permission:"order:insurance:policy"},{id:552,name:"理赔管理",path:"/order/insurance/claims",type:"menu",permission:"order:insurance:claims"}]}]},{id:6,name:"内容管理",icon:"Reading",path:"/content",type:"menu",permission:"content",children:[{id:61,name:"课程管理",path:"/content/course",type:"menu",permission:"content:course",children:[{id:611,name:"课程分类",path:"/content/course/categories",type:"menu",permission:"content:course:categories"},{id:612,name:"课程列表",path:"/content/course/list",type:"menu",permission:"content:course:list"},{id:613,name:"讲师管理",path:"/content/course/teachers",type:"menu",permission:"content:course:teachers"}]},{id:62,name:"广告管理",path:"/content/ad",type:"menu",permission:"content:ad",children:[{id:621,name:"广告位管理",path:"/content/ad/positions",type:"menu",permission:"content:ad:positions"},{id:622,name:"广告内容",path:"/content/ad/list",type:"menu",permission:"content:ad:list"}]},{id:63,name:"资讯管理",path:"/content/article",type:"menu",permission:"content:article",children:[{id:631,name:"文章分类",path:"/content/article/categories",type:"menu",permission:"content:article:categories"},{id:632,name:"文章列表",path:"/content/article/list",type:"menu",permission:"content:article:list"}]}]},{id:7,name:"数据统计",icon:"TrendCharts",path:"/statistics",type:"menu",permission:"statistics",children:[{id:71,name:"运营数据",path:"/statistics/operation",type:"menu",permission:"statistics:operation",children:[{id:711,name:"用户分析",path:"/statistics/operation/users",type:"menu",permission:"statistics:operation:users"},{id:712,name:"订单分析",path:"/statistics/operation/orders",type:"menu",permission:"statistics:operation:orders"},{id:713,name:"收入统计",path:"/statistics/operation/revenue",type:"menu",permission:"statistics:operation:revenue"}]},{id:72,name:"设备数据",path:"/statistics/equipment",type:"menu",permission:"statistics:equipment",children:[{id:721,name:"使用率分析",path:"/statistics/equipment/usage",type:"menu",permission:"statistics:equipment:usage"},{id:722,name:"故障率统计",path:"/statistics/equipment/failure",type:"menu",permission:"statistics:equipment:failure"}]},{id:73,name:"飞手数据",path:"/statistics/pilot",type:"menu",permission:"statistics:pilot",children:[{id:731,name:"接单统计",path:"/statistics/pilot/orders",type:"menu",permission:"statistics:pilot:orders"},{id:732,name:"评分分析",path:"/statistics/pilot/ratings",type:"menu",permission:"statistics:pilot:ratings"}]}]},{id:8,name:"合作商管理",icon:"Money",path:"/partner",type:"menu",permission:"partner",children:[{id:81,name:"合作商信息管理",path:"/partner/info",type:"menu",permission:"partner:info"},{id:82,name:"合作商业绩监控",path:"/partner/performance",type:"menu",permission:"partner:performance"},{id:83,name:"库存管理监控",path:"/partner/inventory",type:"menu",permission:"partner:inventory"},{id:84,name:"推广活动监控",path:"/partner/promotion",type:"menu",permission:"partner:promotion"},{id:85,name:"合作商信用管理",path:"/partner/credit",type:"menu",permission:"partner:credit"}]},{id:9,name:"系统管理",icon:"Setting",path:"/system",type:"menu",permission:"system",children:[{id:91,name:"菜单管理",path:"/system/menu",type:"menu",permission:"system:menu"},{id:92,name:"字典管理",path:"/system/dict",type:"menu",permission:"system:dict"}]}]),u=r(!1),o=r(!1),k=r(!1),h=r({}),w=r([]),l=r(1),s=r(10),V=r(0),x=()=>{l.value=1,c()},T=()=>{m.value.keyword="",x()},S=i=>{s.value=i,c()},K=i=>{l.value=i,c()},c=async()=>{y.value=!0;try{await new Promise(R=>setTimeout(R,300));let i=[...d.value];if(m.value.keyword){const R=m.value.keyword.toLowerCase();i=i.filter(v=>v.name.toLowerCase().includes(R)||v.description.toLowerCase().includes(R))}V.value=i.length;const e=(l.value-1)*s.value,B=e+s.value;d.value=i.slice(e,B)}catch{C.error("获取角色列表失败")}finally{y.value=!1}};W(()=>{c()});const M=()=>{k.value=!1,h.value={},u.value=!0},N=i=>{k.value=!0,h.value={...i},u.value=!0},A=async i=>{C.success(k.value?"角色更新成功":"角色创建成功"),c()},I=async i=>{h.value=i;try{w.value=await E.getRolePermissions(i.id),o.value=!0}catch{C.error("获取角色权限失败")}},j=async()=>{try{await E.saveRolePermissions(h.value.id,w.value),C.success("权限配置保存成功"),o.value=!1}catch{C.error("保存权限配置失败")}},O=i=>{if(i.id===1){C.warning("超级管理员角色不能删除");return}ie.confirm(`确定要删除角色 "${i.name}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{C.success("删除成功"),c()})};return(i,e)=>{const B=p("el-icon"),R=p("el-input"),v=p("el-button"),q=p("el-table-column"),H=p("el-table"),G=p("el-pagination"),J=p("el-dialog"),Q=X("loading");return P(),D("div",pe,[b("div",de,[e[10]||(e[10]=b("h2",null,"角色配置",-1)),b("div",ue,[b("div",ce,[t(R,{modelValue:m.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value.keyword=a),placeholder:"搜索角色名称/描述",clearable:"",onClear:x,class:"search-input"},{prefix:n(()=>[t(B,null,{default:n(()=>[t(Z(ee))]),_:1})]),_:1},8,["modelValue"]),t(v,{type:"primary",onClick:x},{default:n(()=>e[7]||(e[7]=[_("搜索")])),_:1}),t(v,{onClick:T},{default:n(()=>e[8]||(e[8]=[_("重置")])),_:1})]),t(v,{type:"primary",onClick:M},{default:n(()=>e[9]||(e[9]=[_("新建角色")])),_:1})])]),Y((P(),L(H,{data:d.value,style:{width:"100%"},border:""},{default:n(()=>[t(q,{prop:"id",label:"角色ID",width:"100"}),t(q,{prop:"name",label:"角色名称",width:"150"}),t(q,{prop:"description",label:"描述"}),t(q,{prop:"createTime",label:"创建时间",width:"180"}),t(q,{label:"操作",width:"250"},{default:n(({row:a})=>[t(v,{link:"",type:"primary",onClick:U=>N(a)},{default:n(()=>e[11]||(e[11]=[_("编辑")])),_:2},1032,["onClick"]),t(v,{link:"",type:"success",onClick:U=>I(a)},{default:n(()=>e[12]||(e[12]=[_(" 配置权限 ")])),_:2},1032,["onClick"]),t(v,{link:"",type:"danger",onClick:U=>O(a),disabled:a.id===1},{default:n(()=>e[13]||(e[13]=[_(" 删除 ")])),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[Q,y.value]]),b("div",ye,[t(G,{"current-page":l.value,"onUpdate:currentPage":e[1]||(e[1]=a=>l.value=a),"page-size":s.value,"onUpdate:pageSize":e[2]||(e[2]=a=>s.value=a),"page-sizes":[10,20,50,100],total:V.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:S,onCurrentChange:K},null,8,["current-page","page-size","total"])]),t(oe,{visible:u.value,"onUpdate:visible":e[3]||(e[3]=a=>u.value=a),"is-edit":k.value,"role-data":h.value,onSubmit:A},null,8,["visible","is-edit","role-data"]),t(J,{modelValue:o.value,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value=a),title:"配置权限",width:"600px"},{footer:n(()=>[b("span",fe,[t(v,{onClick:e[5]||(e[5]=a=>o.value=!1)},{default:n(()=>e[14]||(e[14]=[_("取消")])),_:1}),t(v,{type:"primary",onClick:j},{default:n(()=>e[15]||(e[15]=[_(" 保存 ")])),_:1})])]),default:n(()=>[h.value.id?(P(),D("div",he,[b("h3",ve,te(h.value.name)+" - 权限配置",1),t(le,{permissions:g.value,checkedKeys:w.value,"onUpdate:checkedKeys":e[4]||(e[4]=a=>w.value=a)},null,8,["permissions","checkedKeys"])])):ne("",!0)]),_:1},8,["modelValue"])])}}},ke=F(_e,[["__scopeId","data-v-09271d02"]]);export{ke as default};
