import{_ as I,r as m,l as $,a as i,o as D,g as j,w as a,e as x,b as e,f as b,v as G,c as H,p as P,u as k,s as J,t as B,z as K}from"./index-58786321.js";import{m as R,_ as Q}from"./rental-32a8fc7a.js";import{_ as q}from"./RuleForm.vue_vue_type_style_index_0_scoped_9c500c05_lang-e1223a77.js";import{a as E}from"./format-44ea9176.js";const W={class:"dialog-footer"},X={__name:"OrderProcessDialog",props:{visible:Boolean,title:{type:String,default:"处理订单"}},emits:["update:visible","submit"],setup(y,{emit:p}){const f=y,u=p,s=m(!1),d=m(null),n=m({action:"return",remarks:""}),w={action:[{required:!0,message:"请选择处理结果",trigger:"change"}],remarks:[{required:!0,message:"请输入处理备注",trigger:"blur"}]};$(()=>f.visible,_=>{s.value=_}),$(s,_=>{var o;u("update:visible",_),_||(o=d.value)==null||o.resetFields()});const v=()=>{s.value=!1},z=async()=>{d.value&&await d.value.validate(_=>{_&&(u("submit",n.value),v())})};return(_,o)=>{const V=i("el-radio"),O=i("el-radio-group"),C=i("el-form-item"),r=i("el-input"),t=i("el-form"),h=i("el-button"),S=i("el-dialog");return D(),j(S,{modelValue:s.value,"onUpdate:modelValue":o[2]||(o[2]=c=>s.value=c),title:y.title,width:"500px"},{footer:a(()=>[x("span",W,[e(h,{onClick:v},{default:a(()=>o[5]||(o[5]=[b("取消")])),_:1}),e(h,{type:"primary",onClick:z},{default:a(()=>o[6]||(o[6]=[b("确定")])),_:1})])]),default:a(()=>[e(t,{ref_key:"formRef",ref:d,model:n.value,rules:w,"label-width":"100px"},{default:a(()=>[e(C,{label:"处理结果",prop:"action"},{default:a(()=>[e(O,{modelValue:n.value.action,"onUpdate:modelValue":o[0]||(o[0]=c=>n.value.action=c)},{default:a(()=>[e(V,{label:"return"},{default:a(()=>o[3]||(o[3]=[b("确认归还")])),_:1}),e(V,{label:"cancel"},{default:a(()=>o[4]||(o[4]=[b("取消订单")])),_:1})]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"备注",prop:"remarks"},{default:a(()=>[e(r,{modelValue:n.value.remarks,"onUpdate:modelValue":o[1]||(o[1]=c=>n.value.remarks=c),type:"textarea",rows:3,placeholder:"请输入处理备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}},Y=I(X,[["__scopeId","data-v-938756aa"]]),F={getOrders(y={}){const{page:p=1,pageSize:f=10,status:u="",keyword:s=""}=y;let d=[...R];return u&&(d=d.filter(n=>n.status===u)),s&&(d=d.filter(n=>n.orderNo.includes(s)||n.customerName.includes(s)||n.equipmentName.includes(s))),Promise.resolve({total:d.length,list:d.slice((p-1)*f,p*f)})},processOrder(y,p,f){const u=R.find(s=>s.id===y);if(!u)return Promise.reject(new Error("Order not found"));switch(p){case"return":u.status="已完成";break;case"cancel":u.status="已取消";break;default:return Promise.reject(new Error("Invalid action"))}return Promise.resolve({success:!0})}};const Z={class:"rental-orders"},ee={class:"header"},te={class:"search-bar"},le={__name:"RentalOrders",setup(y){const p=m({keyword:"",status:""}),f=m([]),u=m(1),s=m(10),d=m(0),n=m(!1),w=m(null),v=async()=>{try{const{list:r,total:t}=await F.getOrders({page:u.value,pageSize:s.value,...p.value});f.value=r,d.value=t}catch{P.error("获取订单列表失败")}},z=()=>{u.value=1,v()},_=r=>{w.value=r,n.value=!0},o=async r=>{try{await F.processOrder(w.value.id,r.action,r),P.success("处理成功"),v()}catch{P.error("处理失败")}},V=r=>{console.log("View details:",r)},O=r=>{s.value=r,v()},C=r=>{u.value=r,v()};return G(()=>{v()}),(r,t)=>{var U;const h=i("el-icon"),S=i("el-input"),c=i("el-option"),M=i("el-select"),N=i("el-button"),g=i("el-table-column"),L=i("el-table"),T=i("el-pagination");return D(),H("div",Z,[x("div",ee,[t[6]||(t[6]=x("h2",null,"租赁订单管理",-1)),x("div",te,[e(S,{modelValue:p.value.keyword,"onUpdate:modelValue":t[0]||(t[0]=l=>p.value.keyword=l),placeholder:"搜索订单号/客户姓名",clearable:"",class:"search-input"},{prefix:a(()=>[e(h,null,{default:a(()=>[e(k(J))]),_:1})]),_:1},8,["modelValue"]),e(M,{modelValue:p.value.status,"onUpdate:modelValue":t[1]||(t[1]=l=>p.value.status=l),placeholder:"订单状态",clearable:""},{default:a(()=>[e(c,{label:"待支付",value:"待支付"}),e(c,{label:"进行中",value:"进行中"}),e(c,{label:"已完成",value:"已完成"}),e(c,{label:"已取消",value:"已取消"})]),_:1},8,["modelValue"]),e(N,{type:"primary",onClick:z},{default:a(()=>t[5]||(t[5]=[b("搜索")])),_:1})])]),e(L,{data:f.value,style:{width:"100%"}},{default:a(()=>[e(g,{prop:"orderNo",label:"订单编号",width:"120"}),e(g,{prop:"equipmentName",label:"设备名称",width:"150"}),e(g,{prop:"customerName",label:"客户姓名",width:"120"}),e(g,{label:"租赁期限",width:"240"},{default:a(({row:l})=>[b(B(k(E)(l.startDate))+" 至 "+B(k(E)(l.endDate)),1)]),_:1}),e(g,{prop:"deposit",label:"押金",width:"120"},{default:a(({row:l})=>[e(k(q),{amount:l.deposit},null,8,["amount"])]),_:1}),e(g,{prop:"rentalFee",label:"租金",width:"120"},{default:a(({row:l})=>[e(k(q),{amount:l.rentalFee},null,8,["amount"])]),_:1}),e(g,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[e(k(Q),{status:l.status},null,8,["status"])]),_:1}),e(g,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[l.status==="进行中"?(D(),j(N,{key:0,size:"small",type:"primary",onClick:A=>_(l)},{default:a(()=>t[7]||(t[7]=[b(" 处理 ")])),_:2},1032,["onClick"])):K("",!0),e(N,{size:"small",onClick:A=>V(l)},{default:a(()=>t[8]||(t[8]=[b("详情")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(T,{"current-page":u.value,"onUpdate:currentPage":t[2]||(t[2]=l=>u.value=l),"page-size":s.value,"onUpdate:pageSize":t[3]||(t[3]=l=>s.value=l),total:d.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",class:"pagination",onSizeChange:O,onCurrentChange:C},null,8,["current-page","page-size","total"]),e(Y,{visible:n.value,"onUpdate:visible":t[4]||(t[4]=l=>n.value=l),title:"处理订单 - "+((U=w.value)==null?void 0:U.orderNo),onSubmit:o},null,8,["visible","title"])])}}},re=I(le,[["__scopeId","data-v-834bc05f"]]);export{re as default};
