import{_ as R,r as d,l as A,a as r,o as F,g as j,w as t,e as x,b as e,f as p,D as X,v as Y,x as Z,c as ee,y as le,u as k,p as V,s as te,C as ae,t as I,q as oe}from"./index-58786321.js";import{e as h}from"./equipmentService-fd1ad789.js";import{f as M}from"./format-44ea9176.js";const ne={class:"dialog-footer"},se={__name:"EquipmentForm",props:{visible:Boolean,isEdit:Boolean,categories:{type:Array,required:!0},equipmentData:{type:Object,default:()=>({})}},emits:["update:visible","submit"],setup(E,{emit:P}){const f=E,w=P,c=d(!1),m=d(null),o=d({code:"",name:"",categoryId:null,model:"",specifications:"",price:0,rentPrice:0,status:"在库"}),S={code:[{required:!0,message:"请输入设备编号",trigger:"blur"}],name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],categoryId:[{required:!0,message:"请选择设备分类",trigger:"change"}],model:[{required:!0,message:"请输入设备型号",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],specifications:[{required:!0,message:"请输入规格参数",trigger:"blur"}],price:[{required:!0,message:"请输入售价",trigger:"blur"}],rentPrice:[{required:!0,message:"请输入租赁价格",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]};A(()=>f.visible,i=>{c.value=i,i&&f.isEdit&&(o.value={...f.equipmentData})}),A(c,i=>{var l;w("update:visible",i),i||(l=m.value)==null||l.resetFields()});const y=async()=>{m.value&&await m.value.validate(i=>{i&&(w("submit",o.value),c.value=!1)})};return(i,l)=>{const _=r("el-input"),v=r("el-form-item"),b=r("el-cascader"),U=r("el-input-number"),q=r("el-option"),B=r("el-select"),$=r("el-form"),z=r("el-button"),D=r("el-dialog");return F(),j(D,{modelValue:c.value,"onUpdate:modelValue":l[9]||(l[9]=s=>c.value=s),title:E.isEdit?"编辑设备":"新增设备",width:"600px"},{footer:t(()=>[x("span",ne,[e(z,{onClick:l[8]||(l[8]=s=>c.value=!1)},{default:t(()=>l[10]||(l[10]=[p("取消")])),_:1}),e(z,{type:"primary",onClick:y},{default:t(()=>l[11]||(l[11]=[p("确定")])),_:1})])]),default:t(()=>[e($,{ref_key:"formRef",ref:m,model:o.value,rules:S,"label-width":"100px"},{default:t(()=>[e(v,{label:"设备编号",prop:"code"},{default:t(()=>[e(_,{modelValue:o.value.code,"onUpdate:modelValue":l[0]||(l[0]=s=>o.value.code=s),placeholder:"请输入设备编号"},null,8,["modelValue"])]),_:1}),e(v,{label:"设备名称",prop:"name"},{default:t(()=>[e(_,{modelValue:o.value.name,"onUpdate:modelValue":l[1]||(l[1]=s=>o.value.name=s),placeholder:"请输入设备名称"},null,8,["modelValue"])]),_:1}),e(v,{label:"设备分类",prop:"categoryId"},{default:t(()=>[e(b,{modelValue:o.value.categoryId,"onUpdate:modelValue":l[2]||(l[2]=s=>o.value.categoryId=s),options:E.categories,props:{checkStrictly:!0,label:"name",value:"id"},placeholder:"请选择设备分类"},null,8,["modelValue","options"])]),_:1}),e(v,{label:"设备型号",prop:"model"},{default:t(()=>[e(_,{modelValue:o.value.model,"onUpdate:modelValue":l[3]||(l[3]=s=>o.value.model=s),placeholder:"请输入设备型号"},null,8,["modelValue"])]),_:1}),e(v,{label:"规格参数",prop:"specifications"},{default:t(()=>[e(_,{modelValue:o.value.specifications,"onUpdate:modelValue":l[4]||(l[4]=s=>o.value.specifications=s),type:"textarea",rows:3,placeholder:"请输入规格参数"},null,8,["modelValue"])]),_:1}),e(v,{label:"售价",prop:"price"},{default:t(()=>[e(U,{modelValue:o.value.price,"onUpdate:modelValue":l[5]||(l[5]=s=>o.value.price=s),min:0,precision:2,step:100,"controls-position":"right"},null,8,["modelValue"])]),_:1}),e(v,{label:"租赁价(天)",prop:"rentPrice"},{default:t(()=>[e(U,{modelValue:o.value.rentPrice,"onUpdate:modelValue":l[6]||(l[6]=s=>o.value.rentPrice=s),min:0,precision:2,step:10,"controls-position":"right"},null,8,["modelValue"])]),_:1}),e(v,{label:"状态",prop:"status"},{default:t(()=>[e(B,{modelValue:o.value.status,"onUpdate:modelValue":l[7]||(l[7]=s=>o.value.status=s),placeholder:"请选择状态"},{default:t(()=>[e(q,{label:"在库",value:"在库"}),e(q,{label:"租出",value:"租出"}),e(q,{label:"维修中",value:"维修中"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}},ue=R(se,[["__scopeId","data-v-5131e378"]]);const re={class:"equipment-list"},ie={class:"header"},de={class:"actions"},pe={class:"search-bar"},ce={__name:"EquipmentList",setup(E){const P=X(),f=d({keyword:"",categoryId:null}),w=d([]),c=d([]),m=d(1),o=d(10),S=d(0),y=d(!1),i=d(!1),l=d(null),_=d(!1),v=u=>({在库:"success",租出:"warning",维修中:"info"})[u]||"info",b=async()=>{_.value=!0;try{const{list:u,total:a}=await h.getEquipments({page:m.value,pageSize:o.value,...f.value});w.value=u,S.value=a}catch{V.error("获取设备列表失败")}finally{_.value=!1}},U=async()=>{try{c.value=await h.getCategories()}catch{V.error("获取分类列表失败")}},q=()=>{m.value=1,b()},B=()=>{i.value=!1,l.value=null,y.value=!0},$=u=>{i.value=!0,l.value={...u},y.value=!0},z=u=>{P.push(`/equipment/inventory/${u.id}`)},D=u=>{oe.confirm(`确定要删除设备 "${u.name}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await h.deleteEquipment(u.id),V.success("删除成功"),b()}catch{V.error("删除失败")}})},s=async u=>{try{i.value?(await h.updateEquipment(l.value.id,u),V.success("更新成功")):(await h.createEquipment(u),V.success("创建成功")),y.value=!1,b()}catch{V.error(i.value?"更新失败":"创建失败")}},O=u=>{o.value=u,b()},G=u=>{m.value=u,b()};return Y(()=>{U(),b()}),(u,a)=>{const H=r("el-cascader"),L=r("el-icon"),J=r("el-input"),C=r("el-button"),g=r("el-table-column"),N=r("el-tag"),K=r("el-table"),Q=r("el-pagination"),W=Z("loading");return F(),ee("div",re,[x("div",ie,[a[7]||(a[7]=x("h2",null,"设备列表",-1)),x("div",de,[x("div",pe,[e(H,{modelValue:f.value.categoryId,"onUpdate:modelValue":a[0]||(a[0]=n=>f.value.categoryId=n),options:c.value,props:{checkStrictly:!0,label:"name",value:"id",emitPath:!1},placeholder:"设备分类",clearable:"",class:"category-select"},null,8,["modelValue","options"]),e(J,{modelValue:f.value.keyword,"onUpdate:modelValue":a[1]||(a[1]=n=>f.value.keyword=n),placeholder:"搜索设备名称/编号",clearable:"",onClear:q,class:"search-input"},{prefix:t(()=>[e(L,null,{default:t(()=>[e(k(te))]),_:1})]),_:1},8,["modelValue"]),e(C,{type:"primary",onClick:q},{default:t(()=>a[5]||(a[5]=[p("搜索")])),_:1})]),e(C,{type:"primary",onClick:B},{default:t(()=>[e(L,null,{default:t(()=>[e(k(ae))]),_:1}),a[6]||(a[6]=p("新增设备 "))]),_:1})])]),le((F(),j(K,{data:w.value,style:{width:"100%"}},{default:t(()=>[e(g,{prop:"code",label:"设备编号",width:"120"}),e(g,{prop:"name",label:"设备名称",width:"180"}),e(g,{prop:"categoryName",label:"分类",width:"120"}),e(g,{prop:"model",label:"型号",width:"120"},{default:t(({row:n})=>[e(N,{size:"small",effect:"plain"},{default:t(()=>[p(I(n.model),1)]),_:2},1024)]),_:1}),e(g,{prop:"specifications",label:"规格参数","show-overflow-tooltip":""}),e(g,{prop:"price",label:"售价",width:"120"},{default:t(({row:n})=>[p(" ¥"+I(k(M)(n.price)),1)]),_:1}),e(g,{prop:"rentPrice",label:"租赁价(天)",width:"120"},{default:t(({row:n})=>[p(" ¥"+I(k(M)(n.rentPrice)),1)]),_:1}),e(g,{prop:"status",label:"状态",width:"100"},{default:t(({row:n})=>[e(N,{type:v(n.status)},{default:t(()=>[p(I(n.status),1)]),_:2},1032,["type"])]),_:1}),e(g,{label:"操作",width:"250",fixed:"right"},{default:t(({row:n})=>[e(C,{size:"small",onClick:T=>$(n)},{default:t(()=>a[8]||(a[8]=[p("编辑")])),_:2},1032,["onClick"]),e(C,{size:"small",type:"success",onClick:T=>z(n)},{default:t(()=>a[9]||(a[9]=[p(" 库存 ")])),_:2},1032,["onClick"]),e(C,{size:"small",type:"danger",onClick:T=>D(n)},{default:t(()=>a[10]||(a[10]=[p(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[W,_.value]]),e(Q,{"current-page":m.value,"onUpdate:currentPage":a[2]||(a[2]=n=>m.value=n),"page-size":o.value,"onUpdate:pageSize":a[3]||(a[3]=n=>o.value=n),total:S.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",class:"pagination",onSizeChange:O,onCurrentChange:G},null,8,["current-page","page-size","total"]),e(k(ue),{visible:y.value,"onUpdate:visible":a[4]||(a[4]=n=>y.value=n),"is-edit":i.value,"equipment-data":l.value,categories:c.value,onSubmit:s},null,8,["visible","is-edit","equipment-data","categories"])])}}},ge=R(ce,[["__scopeId","data-v-42a2af1e"]]);export{ge as default};
