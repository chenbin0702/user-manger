import{_ as L,r as f,v as N,N as O,a as o,o as I,c as U,e as s,b as a,w as t,p as k,u as j,M as X,f as m,t as r,O as F}from"./index-58786321.js";import"./index-17409aec.js";import{u as b,w as q,F as G}from"./xlsx-01326c6b.js";const H={class:"failure-analysis"},J={class:"header"},K={class:"actions"},P={class:"card-content"},Q={class:"card-content"},W={class:"card-content"},Y={class:"card-content"},Z={__name:"FailureAnalysis",setup($){const x=f([]),A=[{text:"最近一周",value:()=>{const n=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*7),[e,n]}},{text:"最近一月",value:()=>{const n=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,n]}},{text:"最近三月",value:()=>{const n=new Date,e=new Date;return e.setMonth(e.getMonth()-3),[e,n]}}],h=f({totalFailures:156,averageFailureRate:3.2,underRepair:12,averageRepairTime:4.5}),y=f([{type:"电池故障",count:45,rate:1.2,avgRepairTime:"2.5小时",trend:-15.5,impact:"中等",solution:"更换电池或维修充电系统"},{type:"电机故障",count:38,rate:1,avgRepairTime:"4.8小时",trend:8.3,impact:"严重",solution:"更换电机或维修传动系统"},{type:"信号故障",count:52,rate:1.4,avgRepairTime:"1.5小时",trend:-5.2,impact:"轻微",solution:"检查天线和信号模块"}]),M=n=>({严重:"danger",中等:"warning",轻微:"info"})[n]||"info",g=f(null),w=f(null);let c=null,u=null;const S=()=>{if(g.value){c=F(g.value);const n=Array.from({length:7},(e,_)=>{const v=new Date;return v.setDate(v.getDate()-_),v.toLocaleDateString()}).reverse();c.setOption({tooltip:{trigger:"axis"},xAxis:{type:"category",data:n},yAxis:{type:"value",axisLabel:{formatter:"{value}%"}},series:[{name:"故障率",type:"line",smooth:!0,data:[3.5,3.2,3.8,3,3.4,3.1,3.2]}]})}w.value&&(u=F(w.value),u.setOption({tooltip:{trigger:"item",formatter:"{b}: {c}次 ({d}%)"},legend:{orient:"vertical",left:"left"},series:[{type:"pie",radius:"50%",data:y.value.map(n=>({name:n.type,value:n.count})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}))},V=()=>{try{const n=b.book_new(),e=b.json_to_sheet(y.value);b.book_append_sheet(n,e,"设备故障分析");const _=q(n,{bookType:"xlsx",type:"array"});G.saveAs(new Blob([_],{type:"application/octet-stream"}),"设备故障分析.xlsx"),k.success("导出成功")}catch{k.error("导出失败")}},z=()=>{R()},R=()=>{S()};N(()=>{R(),window.addEventListener("resize",D)}),O(()=>{window.removeEventListener("resize",D),c&&c.dispose(),u&&u.dispose()});const D=()=>{c&&c.resize(),u&&u.resize()};return(n,e)=>{const _=o("el-date-picker"),v=o("el-icon"),B=o("el-button"),d=o("el-card"),p=o("el-col"),C=o("el-row"),i=o("el-table-column"),T=o("el-tag"),E=o("el-table");return I(),U("div",H,[s("div",J,[e[2]||(e[2]=s("h2",null,"设备故障率统计",-1)),s("div",K,[a(_,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=l=>x.value=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:A,onChange:z},null,8,["modelValue"]),a(B,{type:"primary",onClick:V},{default:t(()=>[a(v,null,{default:t(()=>[a(j(X))]),_:1}),e[1]||(e[1]=m("导出数据 "))]),_:1})])]),a(C,{gutter:20,class:"statistics-cards"},{default:t(()=>[a(p,{span:6},{default:t(()=>[a(d,{shadow:"hover"},{header:t(()=>e[3]||(e[3]=[s("div",{class:"card-header"},[s("span",null,"故障总数")],-1)])),default:t(()=>[s("div",P,r(h.value.totalFailures),1)]),_:1})]),_:1}),a(p,{span:6},{default:t(()=>[a(d,{shadow:"hover"},{header:t(()=>e[4]||(e[4]=[s("div",{class:"card-header"},[s("span",null,"平均故障率")],-1)])),default:t(()=>[s("div",Q,r(h.value.averageFailureRate)+"%",1)]),_:1})]),_:1}),a(p,{span:6},{default:t(()=>[a(d,{shadow:"hover"},{header:t(()=>e[5]||(e[5]=[s("div",{class:"card-header"},[s("span",null,"维修中设备")],-1)])),default:t(()=>[s("div",W,r(h.value.underRepair),1)]),_:1})]),_:1}),a(p,{span:6},{default:t(()=>[a(d,{shadow:"hover"},{header:t(()=>e[6]||(e[6]=[s("div",{class:"card-header"},[s("span",null,"平均修复时间")],-1)])),default:t(()=>[s("div",Y,r(h.value.averageRepairTime)+"h",1)]),_:1})]),_:1})]),_:1}),a(C,{gutter:20,class:"chart-row"},{default:t(()=>[a(p,{span:12},{default:t(()=>[a(d,{class:"chart-card"},{header:t(()=>e[7]||(e[7]=[s("div",{class:"card-header"},[s("span",null,"故障趋势")],-1)])),default:t(()=>[s("div",{ref_key:"trendChartRef",ref:g,class:"chart"},null,512)]),_:1})]),_:1}),a(p,{span:12},{default:t(()=>[a(d,{class:"chart-card"},{header:t(()=>e[8]||(e[8]=[s("div",{class:"card-header"},[s("span",null,"故障类型分布")],-1)])),default:t(()=>[s("div",{ref_key:"typeChartRef",ref:w,class:"chart"},null,512)]),_:1})]),_:1})]),_:1}),a(d,{class:"details-card"},{header:t(()=>e[9]||(e[9]=[s("div",{class:"card-header"},[s("span",null,"故障详情统计")],-1)])),default:t(()=>[a(E,{data:y.value,style:{width:"100%"}},{default:t(()=>[a(i,{prop:"type",label:"故障类型",width:"150"}),a(i,{prop:"count",label:"故障次数",width:"120"}),a(i,{prop:"rate",label:"故障率",width:"120"},{default:t(({row:l})=>[m(r(l.rate)+"% ",1)]),_:1}),a(i,{prop:"avgRepairTime",label:"平均修复时间",width:"150"}),a(i,{prop:"trend",label:"趋势",width:"150"},{default:t(({row:l})=>[a(T,{type:l.trend>=0?"danger":"success"},{default:t(()=>[m(r(l.trend>=0?"+":"")+r(l.trend)+"% ",1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"impact",label:"影响程度",width:"120"},{default:t(({row:l})=>[a(T,{type:M(l.impact)},{default:t(()=>[m(r(l.impact),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"solution",label:"解决方案"})]),_:1},8,["data"])]),_:1})])}}},se=L(Z,[["__scopeId","data-v-8d459e05"]]);export{se as default};
