import{_ as q,r as v,m as V,v as G,N as H,a as n,o as J,c as K,e as o,b as a,w as t,p as D,O as R,f as i,u as y,M as P,t as m}from"./index-58786321.js";import"./index-17409aec.js";import{u as C,w as Q,F as W}from"./xlsx-01326c6b.js";import{f as O}from"./format-44ea9176.js";import{o as Y}from"./orderService-27a58aea.js";const Z={class:"order-statistics"},$={class:"header"},ee={class:"actions"},te={class:"card-content"},ae={class:"card-content"},oe={class:"card-content"},se={class:"card-content"},le={__name:"OrderStatistics",setup(ne){const S=v([]),k=v("month"),l=v({totalOrders:0,totalAmount:0,typeDistribution:[]}),g=v([]),w=v(null),b=v(null);let c=null,p=null;const z=V(()=>(l.value.completed/l.value.totalOrders*100).toFixed(2)),B=V(()=>l.value.totalOrders?l.value.totalAmount/l.value.totalOrders:0),E=[{text:"最近一周",value:()=>{const s=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*7),[e,s]}},{text:"最近一月",value:()=>{const s=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,s]}},{text:"最近三月",value:()=>{const s=new Date,e=new Date;return e.setMonth(e.getMonth()-3),[e,s]}}],x=async()=>{try{const s=await Y.getStatistics();l.value=s,g.value=s.typeDistribution.map(e=>({type:e.type,count:Math.floor(e.value*l.value.totalOrders/100),amount:(e.value*l.value.totalAmount/100).toFixed(2),percentage:e.value})),T()}catch{D.error("加载统计数据失败")}},T=()=>{if(w.value&&(c=R(w.value),c.setOption({tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left"},series:[{type:"pie",radius:"50%",data:l.value.typeDistribution.map(s=>({name:s.type,value:s.value})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]})),b.value){p=R(b.value);const s=Array.from({length:7},(e,f)=>{const r=new Date;return r.setDate(r.getDate()-f),r.toLocaleDateString()}).reverse();p.setOption({tooltip:{trigger:"axis"},xAxis:{type:"category",data:s},yAxis:{type:"value"},series:[{data:Array.from({length:7},()=>Math.floor(Math.random()*100)),type:"line",smooth:!0}]})}},U=()=>{x()},F=()=>{x()},N=()=>{try{const s=C.book_new(),e=C.json_to_sheet(g.value);C.book_append_sheet(s,e,"订单统计");const f=Q(s,{bookType:"xlsx",type:"array"});W.saveAs(new Blob([f],{type:"application/octet-stream"}),"订单统计.xlsx"),D.success("导出成功")}catch{D.error("导出失败")}};G(()=>{x(),window.addEventListener("resize",A)}),H(()=>{window.removeEventListener("resize",A),c&&c.dispose(),p&&p.dispose()});const A=()=>{c&&c.resize(),p&&p.resize()};return(s,e)=>{const f=n("el-date-picker"),r=n("el-radio-button"),L=n("el-radio-group"),j=n("el-icon"),I=n("el-button"),d=n("el-card"),_=n("el-col"),M=n("el-row"),h=n("el-table-column"),X=n("el-table");return J(),K("div",Z,[o("div",$,[e[7]||(e[7]=o("h2",null,"订单统计分析",-1)),o("div",ee,[a(f,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=u=>S.value=u),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:E,onChange:U},null,8,["modelValue"]),a(L,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=u=>k.value=u),onChange:F},{default:t(()=>[a(r,{label:"day"},{default:t(()=>e[2]||(e[2]=[i("日")])),_:1}),a(r,{label:"week"},{default:t(()=>e[3]||(e[3]=[i("周")])),_:1}),a(r,{label:"month"},{default:t(()=>e[4]||(e[4]=[i("月")])),_:1}),a(r,{label:"year"},{default:t(()=>e[5]||(e[5]=[i("年")])),_:1})]),_:1},8,["modelValue"]),a(I,{type:"primary",onClick:N},{default:t(()=>[a(j,null,{default:t(()=>[a(y(P))]),_:1}),e[6]||(e[6]=i("导出数据 "))]),_:1})])]),a(M,{gutter:20,class:"statistics-cards"},{default:t(()=>[a(_,{span:6},{default:t(()=>[a(d,{shadow:"hover"},{header:t(()=>e[8]||(e[8]=[o("div",{class:"card-header"},[o("span",null,"总订单数")],-1)])),default:t(()=>[o("div",te,m(l.value.totalOrders),1)]),_:1})]),_:1}),a(_,{span:6},{default:t(()=>[a(d,{shadow:"hover"},{header:t(()=>e[9]||(e[9]=[o("div",{class:"card-header"},[o("span",null,"总金额")],-1)])),default:t(()=>[o("div",ae,"¥"+m(y(O)(l.value.totalAmount)),1)]),_:1})]),_:1}),a(_,{span:6},{default:t(()=>[a(d,{shadow:"hover"},{header:t(()=>e[10]||(e[10]=[o("div",{class:"card-header"},[o("span",null,"完成率")],-1)])),default:t(()=>[o("div",oe,m(z.value)+"%",1)]),_:1})]),_:1}),a(_,{span:6},{default:t(()=>[a(d,{shadow:"hover"},{header:t(()=>e[11]||(e[11]=[o("div",{class:"card-header"},[o("span",null,"平均订单金额")],-1)])),default:t(()=>[o("div",se,"¥"+m(y(O)(B.value)),1)]),_:1})]),_:1})]),_:1}),a(M,{gutter:20,class:"chart-row"},{default:t(()=>[a(_,{span:12},{default:t(()=>[a(d,{class:"chart-card"},{header:t(()=>e[12]||(e[12]=[o("div",{class:"card-header"},[o("span",null,"订单类型分布")],-1)])),default:t(()=>[o("div",{ref_key:"pieChartRef",ref:w,class:"chart"},null,512)]),_:1})]),_:1}),a(_,{span:12},{default:t(()=>[a(d,{class:"chart-card"},{header:t(()=>e[13]||(e[13]=[o("div",{class:"card-header"},[o("span",null,"订单趋势")],-1)])),default:t(()=>[o("div",{ref_key:"lineChartRef",ref:b,class:"chart"},null,512)]),_:1})]),_:1})]),_:1}),a(d,{class:"table-card"},{header:t(()=>e[14]||(e[14]=[o("div",{class:"card-header"},[o("span",null,"订单分类统计")],-1)])),default:t(()=>[a(X,{data:g.value,style:{width:"100%"}},{default:t(()=>[a(h,{prop:"type",label:"订单类型"}),a(h,{prop:"count",label:"订单数量"}),a(h,{prop:"amount",label:"订单金额"},{default:t(({row:u})=>[i(" ¥"+m(y(O)(u.amount)),1)]),_:1}),a(h,{prop:"percentage",label:"占比"},{default:t(({row:u})=>[i(m(u.percentage)+"% ",1)]),_:1})]),_:1},8,["data"])]),_:1})])}}},pe=q(le,[["__scopeId","data-v-7001a7b5"]]);export{pe as default};
