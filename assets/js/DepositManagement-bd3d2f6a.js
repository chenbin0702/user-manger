import{a as g,b as w,m as Z,_ as ee}from"./rental-32a8fc7a.js";import{_ as U}from"./RuleForm.vue_vue_type_style_index_0_scoped_9c500c05_lang-e1223a77.js";import{_ as q,a as u,o as z,g as I,w as a,e as f,t as M,b as e,r as m,v as te,c as ae,p as k,u as b,f as D,z as le}from"./index-58786321.js";import"./format-44ea9176.js";const oe={class:"card-header"},se={class:"statistics-value"},ne={__name:"StatisticsCard",props:{title:{type:String,required:!0},value:{type:Number,required:!0}},setup(o){return(s,n)=>{const r=u("el-card");return z(),I(r,{class:"statistics-card"},{header:a(()=>[f("div",oe,[f("span",null,M(o.title),1)])]),default:a(()=>[f("div",se,[e(U,{amount:o.value},null,8,["amount"])])]),_:1})}}},x=q(ne,[["__scopeId","data-v-52c08f6a"]]),$={getRentalOrders(o={}){const{page:s=1,pageSize:n=10,status:r="",keyword:i=""}=o;let p=[...Z];return r&&(p=p.filter(c=>c.status===r)),i&&(p=p.filter(c=>c.orderNo.includes(i)||c.customerName.includes(i)||c.equipmentName.includes(i))),Promise.resolve({total:p.length,list:p.slice((s-1)*n,s*n)})},getRentalRules(o={}){const{categoryId:s=""}=o;let n=[...g];return s&&(n=n.filter(r=>r.categoryId===s)),Promise.resolve(n)},updateRentalRule(o,s){const n=g.findIndex(r=>r.id===o);return n>-1?(g[n]={...g[n],...s},Promise.resolve(g[n])):Promise.reject(new Error("Rule not found"))},getDepositRecords(o={}){const{page:s=1,pageSize:n=10,status:r=""}=o;let i=[...w];return r&&(i=i.filter(p=>p.status===r)),Promise.resolve({total:i.length,list:i.slice((s-1)*n,s*n)})},getDepositStatistics(){return Promise.resolve({totalDeposit:w.reduce((o,s)=>o+s.amount,0),pendingDeposit:w.filter(o=>o.status==="待退还").reduce((o,s)=>o+s.amount,0),monthlyRefund:w.filter(o=>o.status==="已退还").reduce((o,s)=>o+s.amount,0)})}};const re={class:"deposit-management"},ue={class:"card-header"},ie={class:"dialog-footer"},de={__name:"DepositManagement",setup(o){const s=m({status:""}),n=m([]),r=m(1),i=m(10),p=m(0),c=m(!1),V=m(null),B=m(null),y=m({totalDeposit:0,pendingDeposit:0,monthlyRefund:0}),v=m({amount:0,remarks:""}),E={amount:[{required:!0,message:"请输入退还金额",trigger:"blur"}],remarks:[{required:!0,message:"请输入备注",trigger:"blur"}]},h=async()=>{try{const{list:d,total:t}=await $.getDepositRecords({page:r.value,pageSize:i.value,status:s.value.status});n.value=d,p.value=t}catch{k.error("获取押金记录失败")}},N=async()=>{try{y.value=await $.getDepositStatistics()}catch{k.error("获取统计数据失败")}},O=d=>{B.value=d,v.value.amount=d.amount,c.value=!0},j=async()=>{V.value&&await V.value.validate(d=>{if(d)try{k.success("押金退还成功"),c.value=!1,h(),N()}catch{k.error("操作失败")}})},F=d=>{i.value=d,h()},L=d=>{r.value=d,h()};return te(()=>{h(),N()}),(d,t)=>{const C=u("el-col"),T=u("el-row"),S=u("el-option"),A=u("el-select"),_=u("el-table-column"),G=u("el-tag"),R=u("el-button"),H=u("el-table"),J=u("el-pagination"),K=u("el-card"),Q=u("el-input-number"),P=u("el-form-item"),W=u("el-input"),X=u("el-form"),Y=u("el-dialog");return z(),ae("div",re,[t[11]||(t[11]=f("div",{class:"header"},[f("h2",null,"押金管理")],-1)),e(T,{gutter:20,class:"statistics-row"},{default:a(()=>[e(C,{span:8},{default:a(()=>[e(b(x),{title:"押金总额",value:y.value.totalDeposit},null,8,["value"])]),_:1}),e(C,{span:8},{default:a(()=>[e(b(x),{title:"待退还押金",value:y.value.pendingDeposit},null,8,["value"])]),_:1}),e(C,{span:8},{default:a(()=>[e(b(x),{title:"本月退还金额",value:y.value.monthlyRefund},null,8,["value"])]),_:1})]),_:1}),e(K,{class:"deposit-list"},{header:a(()=>[f("div",ue,[t[7]||(t[7]=f("span",null,"押金记录",-1)),e(A,{modelValue:s.value.status,"onUpdate:modelValue":t[0]||(t[0]=l=>s.value.status=l),placeholder:"状态筛选",clearable:""},{default:a(()=>[e(S,{label:"待退还",value:"待退还"}),e(S,{label:"已退还",value:"已退还"}),e(S,{label:"已扣除",value:"已扣除"})]),_:1},8,["modelValue"])])]),default:a(()=>[e(H,{data:n.value,style:{width:"100%"}},{default:a(()=>[e(_,{prop:"orderNo",label:"订单编号",width:"120"}),e(_,{prop:"customerName",label:"客户姓名",width:"120"}),e(_,{prop:"amount",label:"押金金额",width:"120"},{default:a(({row:l})=>[e(b(U),{amount:l.amount},null,8,["amount"])]),_:1}),e(_,{prop:"type",label:"类型",width:"100"},{default:a(({row:l})=>[e(G,{type:l.type==="收取"?"success":"warning"},{default:a(()=>[D(M(l.type),1)]),_:2},1032,["type"])]),_:1}),e(_,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[e(b(ee),{status:l.status},null,8,["status"])]),_:1}),e(_,{prop:"time",label:"操作时间",width:"180"}),e(_,{prop:"remarks",label:"备注"}),e(_,{label:"操作",width:"120",fixed:"right"},{default:a(({row:l})=>[l.status==="待退还"?(z(),I(R,{key:0,size:"small",type:"primary",onClick:pe=>O(l)},{default:a(()=>t[8]||(t[8]=[D(" 退还押金 ")])),_:2},1032,["onClick"])):le("",!0)]),_:1})]),_:1},8,["data"]),e(J,{"current-page":r.value,"onUpdate:currentPage":t[1]||(t[1]=l=>r.value=l),"page-size":i.value,"onUpdate:pageSize":t[2]||(t[2]=l=>i.value=l),total:p.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",class:"pagination",onSizeChange:F,onCurrentChange:L},null,8,["current-page","page-size","total"])]),_:1}),e(Y,{modelValue:c.value,"onUpdate:modelValue":t[6]||(t[6]=l=>c.value=l),title:"退还押金",width:"500px"},{footer:a(()=>[f("span",ie,[e(R,{onClick:t[5]||(t[5]=l=>c.value=!1)},{default:a(()=>t[9]||(t[9]=[D("取消")])),_:1}),e(R,{type:"primary",onClick:j},{default:a(()=>t[10]||(t[10]=[D("确定")])),_:1})])]),default:a(()=>[e(X,{ref_key:"formRef",ref:V,model:v.value,rules:E,"label-width":"100px"},{default:a(()=>[e(P,{label:"退还金额",prop:"amount"},{default:a(()=>[e(Q,{modelValue:v.value.amount,"onUpdate:modelValue":t[3]||(t[3]=l=>v.value.amount=l),min:0,precision:2,step:100,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(P,{label:"备注",prop:"remarks"},{default:a(()=>[e(W,{modelValue:v.value.remarks,"onUpdate:modelValue":t[4]||(t[4]=l=>v.value.remarks=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ve=q(de,[["__scopeId","data-v-be72c3b2"]]);export{ve as default};
