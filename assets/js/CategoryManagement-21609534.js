import{_ as D,r as g,m as S,l as M,a as i,o as x,g as E,w as l,e as _,b as a,f as b,z as q,u as $,A as F,B as N,t as U,v as O,c as R,p as V,C as j,q as P}from"./index-58786321.js";import{e as A}from"./equipmentService-fd1ad789.js";const z={class:"dialog-footer"},L={__name:"CategoryForm",props:{visible:Boolean,isEdit:Boolean,parentCategory:{type:Object,default:()=>null},categoryData:{type:Object,default:()=>({})},categoryOptions:{type:Array,default:()=>[]}},emits:["update:visible","submit"],setup(h,{emit:v}){const o=h,c=v,d=g(!1),p=g(null),r=g({name:"",parentId:null,sort:0,description:""}),m=S(()=>o.isEdit?"编辑分类":o.parentCategory?`添加 "${o.parentCategory.name}" 的子分类`:"新增顶级分类"),u={name:[{required:!0,message:"请输入分类名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],sort:[{required:!0,message:"请输入排序值",trigger:"blur"}]};M(()=>o.visible,s=>{d.value=s,s&&(o.isEdit?r.value={...o.categoryData}:o.parentCategory&&(r.value.parentId=o.parentCategory.id))}),M(d,s=>{c("update:visible",s)});const y=()=>{var s;(s=p.value)==null||s.resetFields(),d.value=!1},C=async()=>{p.value&&await p.value.validate(s=>{s&&(c("submit",r.value),y())})};return(s,n)=>{const e=i("el-input"),t=i("el-form-item"),w=i("el-cascader"),k=i("el-input-number"),I=i("el-form"),B=i("el-button"),T=i("el-dialog");return x(),E(T,{modelValue:d.value,"onUpdate:modelValue":n[4]||(n[4]=f=>d.value=f),title:m.value,width:"500px",onClose:y},{footer:l(()=>[_("span",z,[a(B,{onClick:y},{default:l(()=>n[5]||(n[5]=[b("取消")])),_:1}),a(B,{type:"primary",onClick:C},{default:l(()=>n[6]||(n[6]=[b("确定")])),_:1})])]),default:l(()=>[a(I,{ref_key:"formRef",ref:p,model:r.value,rules:u,"label-width":"100px"},{default:l(()=>[a(t,{label:"分类名称",prop:"name"},{default:l(()=>[a(e,{modelValue:r.value.name,"onUpdate:modelValue":n[0]||(n[0]=f=>r.value.name=f),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),h.isEdit?q("",!0):(x(),E(t,{key:0,label:"上级分类"},{default:l(()=>[a(w,{modelValue:r.value.parentId,"onUpdate:modelValue":n[1]||(n[1]=f=>r.value.parentId=f),options:h.categoryOptions,props:{checkStrictly:!0,label:"name",value:"id",emitPath:!1},placeholder:"请选择上级分类",clearable:""},null,8,["modelValue","options"])]),_:1})),a(t,{label:"排序",prop:"sort"},{default:l(()=>[a(k,{modelValue:r.value.sort,"onUpdate:modelValue":n[2]||(n[2]=f=>r.value.sort=f),min:0,max:999,placeholder:"数字越小越靠前"},null,8,["modelValue"])]),_:1}),a(t,{label:"描述",prop:"description"},{default:l(()=>[a(e,{modelValue:r.value.description,"onUpdate:modelValue":n[3]||(n[3]=f=>r.value.description=f),type:"textarea",rows:3,placeholder:"请输入分类描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}},G=D(L,[["__scopeId","data-v-c09b4f4b"]]),H={class:"custom-tree-node"},J={class:"category-name"},K={class:"category-actions"},Q={__name:"CategoryTree",props:{categories:{type:Array,required:!0}},emits:["edit","add-child","delete"],setup(h,{emit:v}){const o=v,c=g(null),d=m=>{o("edit",m)},p=m=>{o("add-child",m)},r=(m,u)=>{o("delete",u)};return(m,u)=>{const y=i("el-icon"),C=i("el-button"),s=i("el-tree");return x(),E(s,{ref_key:"treeRef",ref:c,data:h.categories,"node-key":"id","default-expand-all":"","expand-on-click-node":!1,"highlight-current":""},{default:l(({node:n,data:e})=>[_("div",H,[_("span",J,[e.children&&e.children.length?(x(),E(y,{key:0},{default:l(()=>[a($(F))]),_:1})):(x(),E(y,{key:1},{default:l(()=>[a($(N))]),_:1})),b(" "+U(e.name),1)]),_("span",K,[a(C,{link:"",type:"primary",onClick:t=>d(e)},{default:l(()=>u[0]||(u[0]=[b(" 编辑 ")])),_:2},1032,["onClick"]),a(C,{link:"",type:"primary",onClick:t=>p(e)},{default:l(()=>u[1]||(u[1]=[b(" 添加子分类 ")])),_:2},1032,["onClick"]),a(C,{link:"",type:"danger",onClick:t=>r(n,e),disabled:e.children&&e.children.length>0},{default:l(()=>u[2]||(u[2]=[b(" 删除 ")])),_:2},1032,["onClick","disabled"])])])]),_:1},8,["data"])}}},W=D(Q,[["__scopeId","data-v-36dc2a2e"]]);const X={class:"category-management"},Y={class:"header"},Z={class:"title-section"},ee={class:"action-section"},te={__name:"CategoryManagement",setup(h){const v=g([]),o=g(!1),c=g(!1),d=g({}),p=g(null),r=S(()=>{let e=0;const t=w=>{w.forEach(k=>{e++,k.children&&t(k.children)})};return t(v.value),e}),m=async()=>{try{v.value=await A.getCategories()}catch{V.error("获取分类列表失败")}},u=()=>{c.value=!1,p.value=null,d.value={},o.value=!0},y=e=>{c.value=!1,p.value=e,d.value={},o.value=!0},C=e=>{c.value=!0,d.value={...e},p.value=null,o.value=!0},s=async e=>{try{await P.confirm(`确定要删除分类 "${e.name}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await A.deleteCategory(e.id),V.success("删除成功"),m()}catch(t){t!=="cancel"&&V.error("删除失败")}},n=async e=>{try{c.value?(await A.updateCategory(d.value.id,e),V.success("更新成功")):(await A.createCategory(e),V.success("创建成功")),m()}catch{V.error(c.value?"更新失败":"创建失败")}};return O(()=>{m()}),(e,t)=>{const w=i("el-tag"),k=i("el-icon"),I=i("el-button"),B=i("el-card");return x(),R("div",X,[_("div",Y,[_("div",Z,[t[1]||(t[1]=_("h2",null,"设备分类",-1)),a(w,{type:"info",class:"category-count"},{default:l(()=>[b(" 共 "+U(r.value)+" 个分类 ",1)]),_:1})]),_("div",ee,[a(I,{type:"primary",onClick:u},{default:l(()=>[a(k,null,{default:l(()=>[a($(j))]),_:1}),t[2]||(t[2]=b("新增顶级分类 "))]),_:1})])]),a(B,{class:"category-tree-card"},{header:l(()=>t[3]||(t[3]=[_("div",{class:"card-header"},[_("span",null,"分类树形结构")],-1)])),default:l(()=>[a($(W),{categories:v.value,onEdit:C,onAddChild:y,onDelete:s},null,8,["categories"])]),_:1}),a($(G),{visible:o.value,"onUpdate:visible":t[0]||(t[0]=T=>o.value=T),"is-edit":c.value,"parent-category":p.value,"category-data":d.value,"category-options":v.value,onSubmit:n},null,8,["visible","is-edit","parent-category","category-data","category-options"])])}}},oe=D(te,[["__scopeId","data-v-8111ff1a"]]);export{oe as default};
