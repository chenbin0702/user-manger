import{_ as H,r,m as J,v as K,N as Q,a as n,o as W,c as Y,e as o,b as t,w as a,p as T,u as Z,M as $,f as h,t as w,O as N}from"./index-58786321.js";import"./index-17409aec.js";import{u as D,w as ee,F as te}from"./xlsx-01326c6b.js";const ae={class:"pilot-rating-analysis"},oe={class:"header"},le={class:"actions"},ne={class:"card-content"},se={class:"card-content"},re={class:"card-content"},ie={class:"card-content"},de={class:"card-header"},ue={__name:"RatingAnalysis",setup(pe){const z=r([]),A=[{text:"最近一周",value:()=>{const l=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*7),[e,l]}},{text:"最近一月",value:()=>{const l=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,l]}},{text:"最近三月",value:()=>{const l=new Date,e=new Date;return e.setMonth(e.getMonth()-3),[e,l]}}],m=r({averageRating:4.8,fiveStarRate:85.6,positiveReviews:1280,complaintRate:.5}),f=r("all"),b=r(1),y=r(10),M=r(0),k=r([{pilotName:"张三",orderNo:"ORD20240120001",taskType:"航拍任务",rating:5,comment:"飞手专业素质高，拍摄效果很好",reviewTime:"2024-01-20 10:00:00"},{pilotName:"李四",orderNo:"ORD20240120002",taskType:"测绘任务",rating:4.5,comment:"任务完成及时，态度认真负责",reviewTime:"2024-01-20 11:30:00"}]),U=J(()=>{let l=[...k.value];return f.value==="positive"?l=l.filter(e=>e.rating>=4):f.value==="negative"&&(l=l.filter(e=>e.rating<4)),l}),x=r(null),R=r(null);let d=null,u=null;const O=()=>{if(x.value){d=N(x.value);const l=Array.from({length:7},(e,v)=>{const _=new Date;return _.setDate(_.getDate()-v),_.toLocaleDateString()}).reverse();d.setOption({tooltip:{trigger:"axis"},xAxis:{type:"category",data:l},yAxis:{type:"value",min:4,max:5},series:[{name:"平均评分",type:"line",smooth:!0,data:[4.8,4.7,4.9,4.8,4.7,4.8,4.9]}]})}R.value&&(u=N(R.value),u.setOption({tooltip:{trigger:"item",formatter:"{b}: {c}次 ({d}%)"},legend:{orient:"vertical",left:"left"},series:[{type:"pie",radius:"50%",data:[{value:856,name:"5星"},{value:285,name:"4星"},{value:98,name:"3星"},{value:35,name:"2星"},{value:6,name:"1星"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}))},B=()=>{try{const l=D.book_new(),e=D.json_to_sheet(k.value);D.book_append_sheet(l,e,"飞手评分分析");const v=ee(l,{bookType:"xlsx",type:"array"});te.saveAs(new Blob([v],{type:"application/octet-stream"}),"飞手评分分析.xlsx"),T.success("导出成功")}catch{T.error("导出失败")}},E=()=>{g()},L=l=>{y.value=l,g()},F=l=>{b.value=l,g()},g=()=>{O()};K(()=>{g(),window.addEventListener("resize",V)}),Q(()=>{window.removeEventListener("resize",V),d&&d.dispose(),u&&u.dispose()});const V=()=>{d&&d.resize(),u&&u.resize()};return(l,e)=>{const v=n("el-date-picker"),_=n("el-icon"),P=n("el-button"),i=n("el-card"),p=n("el-col"),S=n("el-row"),C=n("el-radio-button"),j=n("el-radio-group"),c=n("el-table-column"),I=n("el-rate"),X=n("el-table"),q=n("el-pagination");return W(),Y("div",ae,[o("div",oe,[e[5]||(e[5]=o("h2",null,"飞手评分分析",-1)),o("div",le,[t(v,{modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=s=>z.value=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:A,onChange:E},null,8,["modelValue"]),t(P,{type:"primary",onClick:B},{default:a(()=>[t(_,null,{default:a(()=>[t(Z($))]),_:1}),e[4]||(e[4]=h("导出数据 "))]),_:1})])]),t(S,{gutter:20,class:"statistics-cards"},{default:a(()=>[t(p,{span:6},{default:a(()=>[t(i,{shadow:"hover"},{header:a(()=>e[6]||(e[6]=[o("div",{class:"card-header"},[o("span",null,"平均评分")],-1)])),default:a(()=>[o("div",ne,w(m.value.averageRating),1)]),_:1})]),_:1}),t(p,{span:6},{default:a(()=>[t(i,{shadow:"hover"},{header:a(()=>e[7]||(e[7]=[o("div",{class:"card-header"},[o("span",null,"五星率")],-1)])),default:a(()=>[o("div",se,w(m.value.fiveStarRate)+"%",1)]),_:1})]),_:1}),t(p,{span:6},{default:a(()=>[t(i,{shadow:"hover"},{header:a(()=>e[8]||(e[8]=[o("div",{class:"card-header"},[o("span",null,"好评数")],-1)])),default:a(()=>[o("div",re,w(m.value.positiveReviews),1)]),_:1})]),_:1}),t(p,{span:6},{default:a(()=>[t(i,{shadow:"hover"},{header:a(()=>e[9]||(e[9]=[o("div",{class:"card-header"},[o("span",null,"投诉率")],-1)])),default:a(()=>[o("div",ie,w(m.value.complaintRate)+"%",1)]),_:1})]),_:1})]),_:1}),t(S,{gutter:20,class:"chart-row"},{default:a(()=>[t(p,{span:12},{default:a(()=>[t(i,{class:"chart-card"},{header:a(()=>e[10]||(e[10]=[o("div",{class:"card-header"},[o("span",null,"评分趋势")],-1)])),default:a(()=>[o("div",{ref_key:"trendChartRef",ref:x,class:"chart"},null,512)]),_:1})]),_:1}),t(p,{span:12},{default:a(()=>[t(i,{class:"chart-card"},{header:a(()=>e[11]||(e[11]=[o("div",{class:"card-header"},[o("span",null,"评分分布")],-1)])),default:a(()=>[o("div",{ref_key:"distributionChartRef",ref:R,class:"chart"},null,512)]),_:1})]),_:1})]),_:1}),t(i,{class:"reviews-card"},{header:a(()=>[o("div",de,[e[15]||(e[15]=o("span",null,"评价详情",-1)),t(j,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=s=>f.value=s),size:"small"},{default:a(()=>[t(C,{label:"all"},{default:a(()=>e[12]||(e[12]=[h("全部")])),_:1}),t(C,{label:"positive"},{default:a(()=>e[13]||(e[13]=[h("好评")])),_:1}),t(C,{label:"negative"},{default:a(()=>e[14]||(e[14]=[h("差评")])),_:1})]),_:1},8,["modelValue"])])]),default:a(()=>[t(X,{data:U.value,style:{width:"100%"}},{default:a(()=>[t(c,{prop:"pilotName",label:"飞手姓名",width:"120"}),t(c,{prop:"orderNo",label:"订单编号",width:"120"}),t(c,{prop:"taskType",label:"任务类型",width:"120"}),t(c,{prop:"rating",label:"评分",width:"180"},{default:a(({row:s})=>[t(I,{modelValue:s.rating,"onUpdate:modelValue":G=>s.rating=G,disabled:"","show-score":"","text-color":"#ff9900"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(c,{prop:"comment",label:"评价内容","show-overflow-tooltip":""}),t(c,{prop:"reviewTime",label:"评价时间",width:"180"})]),_:1},8,["data"]),t(q,{"current-page":b.value,"onUpdate:currentPage":e[2]||(e[2]=s=>b.value=s),"page-size":y.value,"onUpdate:pageSize":e[3]||(e[3]=s=>y.value=s),total:M.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",class:"pagination",onSizeChange:L,onCurrentChange:F},null,8,["current-page","page-size","total"])]),_:1})])}}},me=H(ue,[["__scopeId","data-v-fefdbdc8"]]);export{me as default};
