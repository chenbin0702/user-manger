import{_ as E,r as m,l as N,a as r,o as q,g as M,w as t,e as g,b as e,f as _,v as K,x as Q,c as W,y as X,u as C,p as D,s as Y,C as Z,t as S,q as ee}from"./index-58786321.js";import{_ as $}from"./RuleForm.vue_vue_type_style_index_0_scoped_9c500c05_lang-e1223a77.js";import"./format-44ea9176.js";const le={class:"dialog-footer"},te={__name:"RuleForm",props:{visible:Boolean,ruleData:{type:Object,default:()=>({})}},emits:["update:visible","submit"],setup(L,{emit:v}){const y=L,c=v,f=m(!1),i=m(null),n=m({minDuration:1,maxDuration:30,depositAmount:0,dailyRate:0,overdueFee:0,damagePolicy:"",isActive:!0}),x={depositAmount:[{required:!0,message:"请输入押金金额",trigger:"blur"}],dailyRate:[{required:!0,message:"请输入日租金",trigger:"blur"}],overdueFee:[{required:!0,message:"请输入逾期费用",trigger:"blur"}],damagePolicy:[{required:!0,message:"请输入损坏赔偿规则",trigger:"blur"}]};N(()=>y.visible,b=>{f.value=b,b&&y.ruleData&&(n.value={...y.ruleData})}),N(f,b=>{c("update:visible",b)});const U=async()=>{i.value&&await i.value.validate(b=>{b&&(c("submit",n.value),f.value=!1)})};return(b,a)=>{const d=r("el-input-number"),V=r("el-form-item"),I=r("el-input"),z=r("el-switch"),B=r("el-form"),k=r("el-button"),P=r("el-dialog");return q(),M(P,{modelValue:f.value,"onUpdate:modelValue":a[8]||(a[8]=s=>f.value=s),title:"编辑租赁规则",width:"500px"},{footer:t(()=>[g("span",le,[e(k,{onClick:a[7]||(a[7]=s=>f.value=!1)},{default:t(()=>a[11]||(a[11]=[_("取消")])),_:1}),e(k,{type:"primary",onClick:U},{default:t(()=>a[12]||(a[12]=[_("确定")])),_:1})])]),default:t(()=>[e(B,{ref_key:"formRef",ref:i,model:n.value,rules:x,"label-width":"100px"},{default:t(()=>[e(V,{label:"租期范围"},{default:t(()=>[e(d,{modelValue:n.value.minDuration,"onUpdate:modelValue":a[0]||(a[0]=s=>n.value.minDuration=s),min:1,class:"duration-input"},null,8,["modelValue"]),a[9]||(a[9]=g("span",{class:"duration-separator"},"至",-1)),e(d,{modelValue:n.value.maxDuration,"onUpdate:modelValue":a[1]||(a[1]=s=>n.value.maxDuration=s),min:1,class:"duration-input"},null,8,["modelValue"]),a[10]||(a[10]=g("span",{class:"duration-unit"},"天",-1))]),_:1}),e(V,{label:"押金",prop:"depositAmount"},{default:t(()=>[e(d,{modelValue:n.value.depositAmount,"onUpdate:modelValue":a[2]||(a[2]=s=>n.value.depositAmount=s),min:0,precision:2,step:100,"controls-position":"right"},null,8,["modelValue"])]),_:1}),e(V,{label:"日租金",prop:"dailyRate"},{default:t(()=>[e(d,{modelValue:n.value.dailyRate,"onUpdate:modelValue":a[3]||(a[3]=s=>n.value.dailyRate=s),min:0,precision:2,step:10,"controls-position":"right"},null,8,["modelValue"])]),_:1}),e(V,{label:"逾期费用/天",prop:"overdueFee"},{default:t(()=>[e(d,{modelValue:n.value.overdueFee,"onUpdate:modelValue":a[4]||(a[4]=s=>n.value.overdueFee=s),min:0,precision:2,step:10,"controls-position":"right"},null,8,["modelValue"])]),_:1}),e(V,{label:"损坏赔偿",prop:"damagePolicy"},{default:t(()=>[e(I,{modelValue:n.value.damagePolicy,"onUpdate:modelValue":a[5]||(a[5]=s=>n.value.damagePolicy=s),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),e(V,{label:"状态",prop:"isActive"},{default:t(()=>[e(z,{modelValue:n.value.isActive,"onUpdate:modelValue":a[6]||(a[6]=s=>n.value.isActive=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},ae=E(te,[["__scopeId","data-v-9c500c05"]]);const oe={class:"rental-rules"},ne={class:"header"},ue={class:"actions"},se={class:"search-bar"},ie={class:"duration"},re={class:"pagination"},de={__name:"RentalRules",setup(L){const v=m([{id:1,categoryId:1,minDuration:1,maxDuration:30,depositAmount:5e3,dailyRate:200,overdueFee:300,isActive:!0},{id:2,categoryId:2,minDuration:7,maxDuration:90,depositAmount:1e4,dailyRate:500,overdueFee:800,isActive:!0},{id:3,categoryId:3,minDuration:1,maxDuration:7,depositAmount:2e3,dailyRate:100,overdueFee:150,isActive:!1}]),y=m(!1),c=m(null),f=m(!1),i=m({keyword:"",type:"",status:""}),n=m(1),x=m(10),U=m(0),b={1:"专业无人机",2:"航拍无人机",3:"配件设备"},a=u=>b[u]||"未知分类",d=async()=>{f.value=!0;try{await new Promise(p=>setTimeout(p,500));let u=[...v.value];if(i.value.keyword){const p=i.value.keyword.toLowerCase();u=u.filter(F=>a(F.categoryId).toLowerCase().includes(p))}i.value.type,i.value.status!==""&&(u=u.filter(p=>p.isActive===(i.value.status===1)));const l=(n.value-1)*x.value,w=l+x.value,h=u.slice(l,w);U.value=u.length,v.value=h}catch{D.error("获取租赁规则失败")}finally{f.value=!1}},V=()=>{c.value=null,y.value=!0},I=u=>{c.value={...u},y.value=!0},z=u=>{ee.confirm("确认要删除该租赁规则吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const l=v.value.findIndex(w=>w.id===u.id);l!==-1&&(v.value.splice(l,1),D.success("删除成功"),d())})},B=async u=>{try{if(c.value){const l=v.value.findIndex(w=>w.id===c.value.id);l!==-1&&(v.value[l]={...c.value,...u}),D.success("更新成功")}else v.value.push({id:Date.now(),...u,isActive:!0}),D.success("创建成功");y.value=!1,d()}catch{D.error(c.value?"更新失败":"创建失败")}},k=()=>{n.value=1,d()},P=()=>{i.value={keyword:"",type:"",status:""},k()},s=u=>{x.value=u,d()},T=u=>{n.value=u,d()};return K(()=>{d()}),(u,l)=>{const w=r("el-icon"),h=r("el-input"),p=r("el-option"),F=r("el-select"),R=r("el-button"),A=r("el-table-column"),j=r("el-tag"),O=r("el-table"),G=r("el-pagination"),H=Q("loading");return q(),W("div",oe,[g("div",ne,[l[9]||(l[9]=g("h2",null,"租赁规则管理",-1)),g("div",ue,[g("div",se,[e(h,{modelValue:i.value.keyword,"onUpdate:modelValue":l[0]||(l[0]=o=>i.value.keyword=o),placeholder:"搜索规则名称/编号",clearable:"",onClear:k,class:"search-input"},{prefix:t(()=>[e(w,null,{default:t(()=>[e(C(Y))]),_:1})]),_:1},8,["modelValue"]),e(F,{modelValue:i.value.type,"onUpdate:modelValue":l[1]||(l[1]=o=>i.value.type=o),placeholder:"规则类型",clearable:"",class:"search-select"},{default:t(()=>[e(p,{label:"租金规则",value:"rent"}),e(p,{label:"押金规则",value:"deposit"}),e(p,{label:"超时规则",value:"overtime"}),e(p,{label:"损坏赔偿",value:"damage"})]),_:1},8,["modelValue"]),e(F,{modelValue:i.value.status,"onUpdate:modelValue":l[2]||(l[2]=o=>i.value.status=o),placeholder:"规则状态",clearable:"",class:"search-select"},{default:t(()=>[e(p,{label:"启用",value:1}),e(p,{label:"禁用",value:0})]),_:1},8,["modelValue"]),e(R,{type:"primary",onClick:k},{default:t(()=>l[6]||(l[6]=[_("搜索")])),_:1}),e(R,{onClick:P},{default:t(()=>l[7]||(l[7]=[_("重置")])),_:1})]),e(R,{type:"primary",onClick:V},{default:t(()=>[e(w,null,{default:t(()=>[e(C(Z))]),_:1}),l[8]||(l[8]=_("新增规则 "))]),_:1})])]),X((q(),M(O,{data:v.value,style:{width:"100%"},border:""},{default:t(()=>[e(A,{prop:"categoryName",label:"设备分类","min-width":"120"},{default:t(({row:o})=>[_(S(a(o.categoryId)),1)]),_:1}),e(A,{label:"租期限制",width:"200"},{default:t(({row:o})=>[g("span",ie,[_(S(o.minDuration)+"-"+S(o.maxDuration)+" ",1),l[10]||(l[10]=g("span",{class:"unit"},"天",-1))])]),_:1}),e(A,{prop:"depositAmount",label:"押金","min-width":"120"},{default:t(({row:o})=>[e(C($),{amount:o.depositAmount},null,8,["amount"])]),_:1}),e(A,{prop:"dailyRate",label:"日租金","min-width":"120"},{default:t(({row:o})=>[e(C($),{amount:o.dailyRate},null,8,["amount"])]),_:1}),e(A,{prop:"overdueFee",label:"逾期费用/天","min-width":"140"},{default:t(({row:o})=>[e(C($),{amount:o.overdueFee},null,8,["amount"])]),_:1}),e(A,{prop:"isActive",label:"状态",width:"100"},{default:t(({row:o})=>[e(j,{type:o.isActive?"success":"info",effect:"plain"},{default:t(()=>[_(S(o.isActive?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(A,{label:"操作",width:"150",fixed:"right"},{default:t(({row:o})=>[e(R,{link:"",type:"primary",onClick:J=>I(o)},{default:t(()=>l[11]||(l[11]=[_(" 编辑 ")])),_:2},1032,["onClick"]),e(R,{link:"",type:"danger",onClick:J=>z(o)},{default:t(()=>l[12]||(l[12]=[_(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,f.value]]),g("div",re,[e(G,{"current-page":n.value,"onUpdate:currentPage":l[3]||(l[3]=o=>n.value=o),"page-size":x.value,"onUpdate:pageSize":l[4]||(l[4]=o=>x.value=o),"page-sizes":[10,20,50,100],total:U.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:s,onCurrentChange:T},null,8,["current-page","page-size","total"])]),e(C(ae),{visible:y.value,"onUpdate:visible":l[5]||(l[5]=o=>y.value=o),"rule-data":c.value,onSubmit:B},null,8,["visible","rule-data"])])}}},ce=E(de,[["__scopeId","data-v-3608a756"]]);export{ce as default};
