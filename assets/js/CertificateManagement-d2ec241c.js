import{_ as Q,r as u,v as W,p as b,a as n,x as X,o as S,c as Z,e as m,b as t,w as l,y as ee,g as te,u as ae,s as le,f as r,q as oe}from"./index-58786321.js";import{_ as se}from"./StatusTag-e9f43f33.js";import{a as A}from"./authService-cb209c4e.js";const ne={class:"certificate-management"},ue={class:"header"},re={class:"actions"},ie={class:"search-bar"},de={class:"pagination"},pe={class:"dialog-footer"},me={__name:"CertificateManagement",setup(fe){const D=u([]),d=u(!1),_=u(!1),V=u(null),s=u({name:"",effectiveDate:"",expiryDate:"",issuingAuthority:"",status:"启用"}),B={name:[{required:!0,message:"请输入证书名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],effectiveDate:[{required:!0,message:"请选择生效日期",trigger:"change"}],expiryDate:[{required:!0,message:"请选择失效日期",trigger:"change"}],issuingAuthority:[{required:!0,message:"请输入发证机构",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},w=o=>o.getTime()<Date.now()-864e5,Y=o=>{if(!s.value.effectiveDate)return!1;const e=new Date(s.value.effectiveDate);return o.getTime()<e.getTime()},p=u({keyword:"",status:""}),f=u(1),y=u(10),h=u(0),C=u(!1);W(async()=>{try{D.value=await A.getCertificates()}catch{b.error("获取证书列表失败")}});const q=()=>{_.value=!1,s.value={name:"",effectiveDate:"",expiryDate:"",issuingAuthority:"",status:"启用"},d.value=!0},E=o=>{_.value=!0,s.value={...o},d.value=!0},T=async()=>{V.value&&await V.value.validate(o=>{o&&(b.success(_.value?"更新成功":"创建成功"),d.value=!1,v())})},$=o=>{oe.confirm(`确定要删除证书 "${o.name}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{b.success("删除成功"),v()})},x=()=>{f.value=1,v()},N=()=>{p.value={keyword:"",status:""},x()},P=o=>{y.value=o,v()},I=o=>{f.value=o,v()},v=async()=>{C.value=!0;try{const{list:o,total:e}=await A.getCertificates({page:f.value,pageSize:y.value,...p.value});D.value=o,h.value=e}catch{b.error("获取证书列表失败")}finally{C.value=!1}};return(o,e)=>{const R=n("el-icon"),k=n("el-input"),z=n("el-option"),j=n("el-select"),i=n("el-button"),c=n("el-table-column"),F=n("el-table"),L=n("el-pagination"),g=n("el-form-item"),M=n("el-date-picker"),U=n("el-radio"),G=n("el-radio-group"),H=n("el-form"),J=n("el-dialog"),K=X("loading");return S(),Z("div",ne,[m("div",ue,[e[14]||(e[14]=m("h2",null,"证书管理",-1)),m("div",re,[m("div",ie,[t(k,{modelValue:p.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>p.value.keyword=a),placeholder:"搜索证书名称/编号",clearable:"",onClear:x,class:"search-input"},{prefix:l(()=>[t(R,null,{default:l(()=>[t(ae(le))]),_:1})]),_:1},8,["modelValue"]),t(j,{modelValue:p.value.status,"onUpdate:modelValue":e[1]||(e[1]=a=>p.value.status=a),placeholder:"证书状态",clearable:"",class:"search-select"},{default:l(()=>[t(z,{label:"启用",value:"启用"}),t(z,{label:"禁用",value:"禁用"})]),_:1},8,["modelValue"]),t(i,{type:"primary",onClick:x},{default:l(()=>e[11]||(e[11]=[r("搜索")])),_:1}),t(i,{onClick:N},{default:l(()=>e[12]||(e[12]=[r("重置")])),_:1})]),t(i,{type:"primary",onClick:q},{default:l(()=>e[13]||(e[13]=[r("新增证书类型")])),_:1})])]),ee((S(),te(F,{data:D.value,style:{width:"100%"},border:""},{default:l(()=>[t(c,{prop:"id",label:"ID",width:"80"}),t(c,{prop:"name",label:"证书名称"}),t(c,{prop:"issuingAuthority",label:"发证机构"}),t(c,{prop:"status",label:"状态",width:"120"},{default:l(({row:a})=>[t(se,{status:a.status},null,8,["status"])]),_:1}),t(c,{label:"操作"},{default:l(({row:a})=>[t(i,{size:"small",onClick:O=>E(a)},{default:l(()=>e[15]||(e[15]=[r("编辑")])),_:2},1032,["onClick"]),t(i,{size:"small",type:"danger",onClick:O=>$(a)},{default:l(()=>e[16]||(e[16]=[r(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[K,C.value]]),m("div",de,[t(L,{"current-page":f.value,"onUpdate:currentPage":e[2]||(e[2]=a=>f.value=a),"page-size":y.value,"onUpdate:pageSize":e[3]||(e[3]=a=>y.value=a),"page-sizes":[10,20,50,100],total:h.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:P,onCurrentChange:I},null,8,["current-page","page-size","total"])]),t(J,{modelValue:d.value,"onUpdate:modelValue":e[10]||(e[10]=a=>d.value=a),title:_.value?"编辑证书":"新增证书",width:"500px"},{footer:l(()=>[m("span",pe,[t(i,{onClick:e[9]||(e[9]=a=>d.value=!1)},{default:l(()=>e[19]||(e[19]=[r("取消")])),_:1}),t(i,{type:"primary",onClick:T},{default:l(()=>e[20]||(e[20]=[r("确定")])),_:1})])]),default:l(()=>[t(H,{ref_key:"formRef",ref:V,model:s.value,rules:B,"label-width":"100px"},{default:l(()=>[t(g,{label:"证书名称",prop:"name"},{default:l(()=>[t(k,{modelValue:s.value.name,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.name=a)},null,8,["modelValue"])]),_:1}),t(g,{label:"生效日期",prop:"effectiveDate"},{default:l(()=>[t(M,{modelValue:s.value.effectiveDate,"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.effectiveDate=a),type:"date",placeholder:"选择生效日期","value-format":"YYYY-MM-DD","disabled-date":w,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(g,{label:"失效日期",prop:"expiryDate"},{default:l(()=>[t(M,{modelValue:s.value.expiryDate,"onUpdate:modelValue":e[6]||(e[6]=a=>s.value.expiryDate=a),type:"date",placeholder:"选择失效日期","value-format":"YYYY-MM-DD","disabled-date":a=>w(a)||Y(a),style:{width:"100%"}},null,8,["modelValue","disabled-date"])]),_:1}),t(g,{label:"发证机构",prop:"issuingAuthority"},{default:l(()=>[t(k,{modelValue:s.value.issuingAuthority,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.issuingAuthority=a)},null,8,["modelValue"])]),_:1}),t(g,{label:"状态",prop:"status"},{default:l(()=>[t(G,{modelValue:s.value.status,"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.status=a)},{default:l(()=>[t(U,{label:"启用"},{default:l(()=>e[17]||(e[17]=[r("启用")])),_:1}),t(U,{label:"禁用"},{default:l(()=>e[18]||(e[18]=[r("禁用")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},_e=Q(me,[["__scopeId","data-v-406590eb"]]);export{_e as default};
